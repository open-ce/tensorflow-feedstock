From ba2c5f49780a4d7c0094d864aafafff2eaf8c2a1 Mon Sep 17 00:00:00 2001
From: Nishidha Panpaliya <npanpa23@in.ibm.com>
Date: Tue, 18 Jul 2023 12:12:18 +0000
Subject: [PATCH] Fix cpuinfo and downgrade boringssl

---
 tensorflow/workspace2.bzl                  |  7 +++--
 third_party/0001-Support-for-ppc64le.patch | 36 ++++++++++++++++++++++
 2 files changed, 40 insertions(+), 3 deletions(-)
 create mode 100644 third_party/0001-Support-for-ppc64le.patch

diff --git a/tensorflow/workspace2.bzl b/tensorflow/workspace2.bzl
index da9295adaba..527794eab57 100644
--- a/tensorflow/workspace2.bzl
+++ b/tensorflow/workspace2.bzl
@@ -166,6 +166,7 @@ def _tf_repositories():
     tf_http_archive(
         name = "cpuinfo",
         strip_prefix = "cpuinfo-3dc310302210c1891ffcfb12ae67b11a3ad3a150",
+        patch_file = ["//third_party:0001-Support-for-ppc64le.patch"],
         sha256 = "ba668f9f8ea5b4890309b7db1ed2e152aaaf98af6f9a8a63dbe1b75c04e52cb9",
         urls = tf_mirror_urls("https://github.com/pytorch/cpuinfo/archive/3dc310302210c1891ffcfb12ae67b11a3ad3a150.zip"),
     )
@@ -564,10 +565,10 @@ def _tf_repositories():
 
     tf_http_archive(
         name = "boringssl",
-        sha256 = "9dc53f851107eaf87b391136d13b815df97ec8f76dadb487b58b2fc45e624d2c",
-        strip_prefix = "boringssl-c00d7ca810e93780bd0c8ee4eea28f4f2ea4bcdc",
+        sha256 = "534fa658bd845fd974b50b10f444d392dfd0d93768c4a51b61263fd37d851c40",
+        strip_prefix = "boringssl-b9232f9e27e5668bc0414879dcdedb2a59ea75f2",
         system_build_file = "//third_party/systemlibs:boringssl.BUILD",
-        urls = tf_mirror_urls("https://github.com/google/boringssl/archive/c00d7ca810e93780bd0c8ee4eea28f4f2ea4bcdc.tar.gz"),
+        urls = tf_mirror_urls("https://github.com/google/boringssl/archive/b9232f9e27e5668bc0414879dcdedb2a59ea75f2.tar.gz"),
     )
 
     # Note: if you update this, you have to update libpng too. See cl/437813808
diff --git a/third_party/0001-Support-for-ppc64le.patch b/third_party/0001-Support-for-ppc64le.patch
new file mode 100644
index 00000000000..65c914ea873
--- /dev/null
+++ b/third_party/0001-Support-for-ppc64le.patch
@@ -0,0 +1,36 @@
+From def97b3f85d390edce6d1b8cfa2ab1f49c1f66a6 Mon Sep 17 00:00:00 2001
+From: Nishidha Panpaliya <npanpa23@in.ibm.com>
+Date: Tue, 18 Jul 2023 12:11:01 +0000
+Subject: [PATCH] Port on ppc64le
+
+---
+ BUILD.bazel | 6 ++++++
+ 1 file changed, 6 insertions(+)
+
+diff --git a/BUILD.bazel b/BUILD.bazel
+index 0c92064..d30f075 100644
+--- a/BUILD.bazel
++++ b/BUILD.bazel
+@@ -113,6 +113,7 @@ cc_library(
+         ":linux_mips64": COMMON_SRCS + LINUX_SRCS,
+         ":linux_riscv64": COMMON_SRCS + LINUX_SRCS,
+         ":linux_s390x": COMMON_SRCS + LINUX_SRCS,
++        ":linux_ppc64le": COMMON_SRCS + LINUX_SRCS,
+         ":macos_x86_64": COMMON_SRCS + X86_SRCS + MACH_SRCS + MACH_X86_SRCS,
+         ":macos_arm64": COMMON_SRCS + MACH_SRCS + MACH_ARM_SRCS,
+         ":windows_x86_64": COMMON_SRCS + X86_SRCS + WINDOWS_X86_SRCS,
+@@ -239,6 +240,11 @@ config_setting(
+     values = {"cpu": "s390x"},
+ )
+ 
++config_setting(
++    name = "linux_ppc64le",
++    values = {"cpu": "ppc"},
++)
++
+ config_setting(
+     name = "macos_x86_64",
+     values = {
+-- 
+2.40.1
+
-- 
2.40.1

